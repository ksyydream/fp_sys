<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>注册</title>
  <meta name="description" content="注册">
  <meta name="keywords" content="index">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="icon" type="image/png" href="/assets/i/favicon.png">
  <link rel="apple-touch-icon-precomposed" href="/assets/i/app-icon72x72@2x.png">
  <meta name="apple-mobile-web-app-title" content="Amaze UI" />
  <link rel="stylesheet" href="/assets/css/amazeui.css"/>
  <link rel="stylesheet" href="/assets/css/app.css?v2">
    <style>
        /*地址选择*/
        .picker .picker-panel .wheel-wrapper .wheel .wheel-scroll .wheel-item{font-size:14px;}
        .picker .picker-panel .picker-choose .picker-title{line-height:20px !important;font-size:16px; font-weight:normal;}
        .picker .picker-panel .picker-choose .cancel, .picker .picker-panel .picker-choose .confirm{top:0 !important;}
    </style>
  <script type="text/javascript">
    (function() {
        var rem, dpr, time, doc = window.document,
        docEl = doc.documentElement,
        viewport = doc.querySelector('meta[name="viewport"]'),
        zoomScale,
        zoomScaleNum;
        if (viewport) {            
            zoomScale = viewport.getAttribute("content").match(/initial\-scale=(["']?)([\d\.]+)\1?/);
            if(zoomScale){
              zoomScaleNum = parseFloat(zoomScale[2]);
              dpr = parseInt(1 / zoomScaleNum);
            }
        }
        if (!dpr && !zoomScaleNum) {
            var os = (window.navigator.appVersion.match(/android/gi), window.navigator.appVersion.match(/iphone/gi)),
            dpr = window.devicePixelRatio;
            dpr = os ? dpr >= 3 ? 3 : dpr >= 2 ? 2 : 1 : 1;
            zoomScaleNum = 1 / dpr;
        }
        window.addEventListener("resize",
            function() {
                clearTimeout(time);
                time = setTimeout(changeRem, 300);
            },false);
      //改变基准rem
        function changeRem(){
            var docWidth = docEl.getBoundingClientRect().width;
            if(docWidth / dpr > 540){
              docWidth = 540 * dpr;
            }
            //rem字号以320下的16px为基线进行等比缩放
            rem = docWidth/320 * 16;
            docEl.style.fontSize = rem + "px";
        }
        changeRem();
    })();
  </script> 
  
</head>
<body>
<div class="am-main">

 
  <form class="am-form am-form-horizontal" id="reg_form">
       <p class="p-tit">请选择注册类型</p>
     <div class="am-fast-estimate">
           <div class="am-form-group">
      <label class="am-u-sm-3 am-form-label">注册类型</label>
      <div class="am-u-sm-7">
        <div class="radio-input">
          <label class="register-type-label"><input type="radio" name="type_id" checked="checked" class="radio_DBY_" value="1"> 门店注册</input></label>
          <label class="register-type-label"><input type="radio" name="type_id" class="radio_DBY_" value="2"> 直客注册</input></label>
      </div>
      </div>
    </div>

     </div>
    <p class="p-tit">请填写基本信息</p>
     <div class="am-fast-estimate">
    <div class="am-form-group">
      <label for="rel_name" class="am-u-sm-3 am-form-label">姓名</label>
      <div class="am-u-sm-9">
        <input type="text" class="ip-txt" id="rel_name" name="rel_name" value="" placeholder="请输入您的姓名">
      </div>
    </div>

    <div class="am-form-group">
      <label for="mobile" class="am-u-sm-3 am-form-label">手机号</label>
      <div class="am-u-sm-9">
       <input type="text" class="ip-txt js4phone" maxlength="11" id="mobile" name="mobile" value="" placeholder="请输入您的手机号">
      </div>
    </div>
        <div class="am-form-group">
           <div class="am-u-sm-8 yzcode-div">
       <input type="text" class="ip-txt yzcode js4phone" maxlength="5" id="code" name="code" value="" placeholder="请输入验证码">
      </div>
      <a class="am-btn am-yzcode" id="get_code" href="javascript:void(0);">获取验证码</a>
     
    </div>
    <div class="am-form-group">
      <label for="invite_code" class="am-u-sm-3 am-form-label">注册邀请码</label>
      <div class="am-u-sm-9">
          <input type="text" class="ip-txt js4carNo_6" id="invite_code" name="invite_code" value="{{$invite_code|default:''}}" placeholder="请输入邀请码">
      </div>
    </div>

 </div>
      <div id="radio_div">
          <p class="p-tit">请填写门店信息</p>

          <div class="am-fast-estimate">
              <div class="am-form-group">
                  <label for="shop_name" class="am-u-sm-3 am-form-label">门店名称</label>
                  <div class="am-u-sm-9">
                      <input type="text" class="ip-txt" id="shop_name" name="shop_name" value="" placeholder="请填写门店名称">
                  </div>
              </div>
              <div class="am-form-group" id="picker_div">
                  <div class="am-u-sm-9 yzcode-div"><p class="am-spec-input am-spec-txt" id="picker">请选择您的所在区域</p></div>
                  <input type="hidden" name="area_value" id="area_value" value="">
                  <label class="am-u-sm-3 am-form-label"><i class="am-icon-chevron am-icon-chevron1"></i></label>
              </div>
              <div class="am-form-group">
                  <label for="address" class="am-u-sm-3 am-form-label">详细地址</label>
                  <div class="am-u-sm-9">
                      <input type="text" class="ip-txt" id="address" name="address" value="" placeholder="请输入详细地址">
                  </div>
              </div>
          </div>
      </div>
    <a class="am-btn am-btn-register" id="save_btn" href="javascript:">立即注册</a>
  </form>


   <!--<div class="am-menu am-g-fixed am-g-menu">
      <div class="am-u-sm-4"><a href="/wx_index/main" class="am-btn-home"><img src="/assets/images/home.png" alt=""></a></div>
      <div class="am-u-sm-4 am-spec"><a href="" class="am-btn-home"><img src="/assets/images/jj.png" alt=""></a></div>
       <div class="am-u-sm-4"><a href="/wx_index/person_info" class="am-btn-home"><img src="/assets/images/user.png" alt=""></a></div>
  </div>-->
</div>
<script src="/assets/js/jquery-2.2.3.min.js"></script>
<script src="/assets/js/layer/layer.js"></script>
<script src="/assets/js/amazeui.js"></script>
<script src="/assets/js/animateBackground-plugin.js"></script>
<script src="/assets/js/picker.min.js"></script>
<script src="/assets/js/index.js?v2=2"></script>
<script src="/assets/js/DBY_common.js"></script>
<script type="text/javascript">
    var wait = 120;
    $("#get_code").click(function () {
        if (wait != 120) {
            layer.msg('120秒内不允许重复发送');
            return false;
        }
        var o = this;
        var mo = $('#mobile').val();
        if(!mo){
            layer.msg('手机号不能为空');
            return false;
        }
        var iphone = /^1[0-9]{10}$/g;
        if(!(iphone.test(mo))){
            layer.msg('手机号不规范');
            return false;
        }
        $.ajax({
            url:'/wx_api/sendSms?t='+Math.random(),
            type:'get',
            dataType:'json',
            data:{type:'1', mobile:mo},
            success:function(res){
                if(res.status==1){
                    timer();
                }else{
                    layer.msg(res.msg);
                    return false;
                }
            },
            error:function(){
                layer.msg('网络错误，请稍后再试！');
            }
        })
    });

    function timer() {
        if (wait <= 0) {
            $('#get_code').attr("disabled",false);
            $("#get_code").html("获取验证码");
            wait = 120;
        } else {
            $('#get_code').attr("disabled",true);
            $("#get_code").html("重新发送(" + wait + ")");
            wait--;
            setTimeout(function() {
                timer()
            }, 1000)
        }
    }

    $(".radio_DBY_").click(function(){
        var type_id = $("input[name='type_id']:checked").val();
        if(type_id == '1'){
            $("#radio_div").show();
        }
        if(type_id == '2'){
            $("#radio_div").hide();
        }
    });
    $("#save_btn").click(function(){
        var type_id = $("input[name='type_id']:checked").val();
        var mobile = $.trim($("#mobile").val());
        var code = $.trim($("#code").val());
        var rel_name = $.trim($("#rel_name").val());
        var invite_code = $.trim($("#invite_code").val());
        if(rel_name == ''){
            layer.msg('姓名不能为空');
            return false;
        }
        if(mobile == ''){
            layer.msg('手机号不能为空');
            return false;
        }
        var iphone = /^1[0-9]{10}$/g;
        if(!(iphone.test(mobile))){
            layer.msg('手机号不能为空');
            return false;
        }
        if(code == ''){
            layer.msg('验证码不能为空');
            return false;
        }
        if(invite_code == ''){
            layer.msg('邀请码不能为空');
            return false;
        }
        switch (type_id){
            case '1':
                var shop_name = $.trim($("#shop_name").val());//获取门店名称
                var areaVal = $("#area_value").val();//获取所在区域
                var addressVal = $("#address").val();//获取详细地址
                //详细地址验证
                if(shop_name == ''){
                    layer.msg('请填写门店名称');
                    return false;
                }
                //所在区域验证
                if(areaVal == ''){
                    layer.msg('请设置所在区域');
                    return false;
                }
                //详细地址验证
                if(addressVal == ''){
                    layer.msg('请填写详细地址');
                    return false;
                }
                break;
            case '2':
                break;
            default:
                layer.msg('请选择注册类型');
                return false;
        }

        var form = document.getElementById('reg_form');

        var formdata = new FormData(form);
        $.ajax({
            type : "POST",
            url : "/wx_index/reg_save",
            data : formdata,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            success : function(data) {
                var return_ = JSON.parse(data)
                if(return_.status == 1){
                    window.location.href= '/wx_users/index';
                }else{
                   layer.msg(return_.msg);
                }
            }
        });
    })

</script>
</body>
</html>
