<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>历史查询记录</title>
    <meta name="description" content="历史查询记录">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width,initial-sciale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="/assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="/assets/css/amazeui.css"/>
    <link rel="stylesheet" href="/assets/css/app.css">
    <!--<style> html,body,.am-main{ height: 100%;}</style>-->
    <script type="text/javascript">
        (function() {
            var rem, dpr, time, doc = window.document,
                    docEl = doc.documentElement,
                    viewport = doc.querySelector('meta[name="viewport"]'),
                    zoomScale,
                    zoomScaleNum;
            if (viewport) {
                zoomScale = viewport.getAttribute("content").match(/initial\-scale=(["']?)([\d\.]+)\1?/);
                if(zoomScale){
                    zoomScaleNum = parseFloat(zoomScale[2]);
                    dpr = parseInt(1 / zoomScaleNum);
                }
            }
            if (!dpr && !zoomScaleNum) {
                var os = (window.navigator.appVersion.match(/android/gi), window.navigator.appVersion.match(/iphone/gi)),
                        dpr = window.devicePixelRatio;
                dpr = os ? dpr >= 3 ? 3 : dpr >= 2 ? 2 : 1 : 1;
                zoomScaleNum = 1 / dpr;
            }
            window.addEventListener("resize",
                    function() {
                        clearTimeout(time);
                        time = setTimeout(changeRem, 300);
                    },false);
            //改变基准rem
            function changeRem(){
                var docWidth = docEl.getBoundingClientRect().width;
                if(docWidth / dpr > 540){
                    docWidth = 540 * dpr;
                }
                //rem字号以320下的16px为基线进行等比缩放
                rem = docWidth/320 * 16;
                docEl.style.fontSize = rem + "px";
            }
            changeRem();
        })();
    </script>

</head>
<body>
<div class="am-main">
    <div id="wrapper" data-am-widget="list_news" class="am-list-news">
            <ul class="am-data-history am-form" id="events-list">

            </ul>
    </div>
    <!-- 搜索弹框end -->
    <div class="am-menu am-g-fixed am-g-menu">
        <div class="am-u-sm-6"><a href="/wx_index/main" class="am-btn-home"><img src="/assets/i/home.jpg" alt=""></a></div>
        <div class="am-u-sm-6"><a href="/wx_index/person_info" class="am-btn-home"><img src="/assets/i/user_over.jpg" alt=""></a></div>
    </div>
</div>
<script src="/assets/js/zepto.min.js"></script>
<script src="/assets/js/dropload.min.js"></script>
<script>
    $(function(){
        var counter = 0;
        // 每页展示4个
        var num = 4;
        var pageStart = 0,pageEnd = 0;

        // dropload
        $('#wrapper').dropload({
            scrollArea : window,
            loadDownFn : function(me){
                $.ajax({
                    type: 'GET',
                    url: '/wx_index/get_pg_log_list',
                    dataType: 'json',
                    success: function(data){
                        var result = '';
                        counter++;
                        pageEnd = num * counter;
                        pageStart = pageEnd - num;
                        for(var i = pageStart; i < pageEnd; i++){
                            result += '<li><a href="/wx_index/person_pg_histroy_detail/{{id}}"><div class="am-u-sm-8"><span class="am-h-name">'
                                    +data.events[i].name+'</span><span class="am-h-pgstyle">'
                                    +data.events[i].status_name+'</span></div><div class="am-u-sm-4 am-form-label">'
                                    +data.events[i].cdate_day+'</div> <i class="am-icon-chevron"></i></a></li>'
                            if((i + 1) >= data.events.length){
                                // 锁定
                                me.lock();
                                // 无数据
                                me.noData();
                                break;
                            }
                        }
                        // 为了测试，延迟1秒加载
                       // setTimeout(function(){
                            $('#events-list').append(result);
                            // 每次数据加载完，必须重置
                            me.resetload();
                       // },1000);
                    },
                    error: function(xhr, type){
                        alert('Ajax error!');
                        // 即使加载出错，也得重置
                        me.resetload();
                    }
                });
            }
        });
    });
</script>
</body>
</html>
