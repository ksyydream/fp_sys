<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>我要评估</title>
  <meta name="description" content="我要评估">
  <meta name="keywords" content="index">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="icon" type="image/png" href="/assets/i/favicon.png">
  <link rel="apple-touch-icon-precomposed" href="/assets/i/app-icon72x72@2x.png">
  <meta name="apple-mobile-web-app-title" content="Amaze UI" />
  <link rel="stylesheet" href="/assets/css/amazeui.css"/>
  <link rel="stylesheet" href="/assets/css/app.css">
  <script type="text/javascript">
    (function() {
        var rem, dpr, time, doc = window.document,
        docEl = doc.documentElement,
        viewport = doc.querySelector('meta[name="viewport"]'),
        zoomScale,
        zoomScaleNum;
        if (viewport) {            
            zoomScale = viewport.getAttribute("content").match(/initial\-scale=(["']?)([\d\.]+)\1?/);
            if(zoomScale){
              zoomScaleNum = parseFloat(zoomScale[2]);
              dpr = parseInt(1 / zoomScaleNum);
            }
        }
        if (!dpr && !zoomScaleNum) {
            var os = (window.navigator.appVersion.match(/android/gi), window.navigator.appVersion.match(/iphone/gi)),
            dpr = window.devicePixelRatio;
            dpr = os ? dpr >= 3 ? 3 : dpr >= 2 ? 2 : 1 : 1;
            zoomScaleNum = 1 / dpr;
        }
        window.addEventListener("resize",
            function() {
                clearTimeout(time);
                time = setTimeout(changeRem, 300);
            },false);
      //改变基准rem
        function changeRem(){
            var docWidth = docEl.getBoundingClientRect().width;
            if(docWidth / dpr > 540){
              docWidth = 540 * dpr;
            }
            //rem字号以320下的16px为基线进行等比缩放
            rem = docWidth/320 * 16;
            docEl.style.fontSize = rem + "px";
        }
        changeRem();
    })();
  </script> 
  
</head>
<body>
<div class="am-main">
  <div class="am-price" id="my-scrollspy">
    <!-- <div id="wave" class="wave"></div> -->
    <div class="am-re-price">
      <div class="am-re-price-inner">
        <p class="am-house-p" id="am-price-num"><span class="am-house-num">-----</span><br />
        元/㎡</p></div>
    </div>
      <div class="am-float-tag am-float-tag1">
          <em class="am-em-tag em-hty-tag3">大户型</em>
          <!-- 大 am-hty-tag1 中 am-hty-tag2 小am-hty-tag3  -->
      </div>
      <div class="am-float-tag am-float-tag2">
          <em class="am-em-tag em-floor-tag4">中层</em>
          <!-- 底5  低3 中1 高2 顶4 -->
      </div>
      <div class="am-float-tag am-float-tag3">
          <em class="am-em-tag em-hot-tag3">热度</em>
          <!-- 热2 一般3  冷1 -->
      </div>
  </div>
  <div class="am-fast-estimate">
  <form class="am-form am-form-horizontal">
     <div class="am-form-group">
      <label class="am-u-sm-3 am-form-label">小区</label>
      <div class="am-u-sm-9">
        <!--<a href="javascript:" class="before-input" id="am-house-input">请输入</a>-->
        <input type="text" value="" placeholder="请输入" class="ip-txt" id="am-house-input">
        <i class="am-icon-chevron"></i>
      </div>
    </div>
    <div class="am-form-group">
      <label class="am-u-sm-3 am-form-label">物业类型</label>
      <div class="am-u-sm-9 am-form-select">         
        <a href="javascript:" id="yy_wy" class="before-input am-imitate-select"  data-am-modal="{target: '#my-actions-search'}">多层</a><i class="am-icon-chevron"></i>
      </div>
    </div>
    <div class="am-form-group">
      <label class="am-u-sm-3 am-form-label">坐落位置</label>
      <div class="am-u-sm-9">
        <p class="am-spec-input" id="yy_address"></p>
      </div>
    </div>
    <div class="am-form-group">
      <label class="am-u-sm-3 am-form-label">所属区域</label>
      <div class="am-u-sm-9">
        <p class="am-spec-input" id="yy_area"></p>
      </div>
    </div>
  </form>
  </div>

  <div class="am-accurate-estimate" id="accordion">
     <div id="collapse-nav" class="am-panel-collapse am-collapse">
    <form class="am-form am-form-horizontal">
     <div class="am-form-group">
      <label  class="am-u-sm-3 am-form-label">建筑面积</label>
      <div class="am-u-sm-9">
        <input type="number" class="ip-txt" id="yy_mianji" value="" placeholder="请输入"><i>㎡</i>
      </div>
    </div>
    <div class="am-form-group" id="yy_szlc_div">
      <label  class="am-u-sm-3 am-form-label">所在楼层</label>
      <div class="am-u-sm-9">
        <input type="number" class="ip-txt phone4js" id="yy_szlc" value="" placeholder="请输入"><i>层</i>
      </div>
    </div>
    <div class="am-form-group">
      <label class="am-u-sm-3 am-form-label">总楼层</label>
      <div class="am-u-sm-9">
        <input type="number" class="ip-txt phone4js" id="yy_zlc" value="" placeholder="请输入"><i>层</i>
      </div>
    </div>
  </form>
         <input type="hidden" id="yy_min_c" value="">
         <input type="hidden" id="yy_max_c" value="">
         <input type="hidden" id="yy_flag" value="">
         <input type="hidden" id="yy_price_id" value="">
         <input type="hidden" id="pg_price" value="">
</div>
    <div class="am-show-btn" data-am-collapse="{target: '#collapse-nav'}">
      <p class="am-u-sm-6 am-u-sm-centered am-show-btn-p am-hidden-btn-p">继续填写，精准评估</p></div>
   <div class="am-accu-btns">
     <div class="am-u-sm-12 am-u-sm-centered">  
      <a class="am-btn am-btn-danger am-fleft" href="javascript:" id="jisuan_btn">立即估价</a><a class="am-btn am-btn1 am-btn-danger" href="javascript:;" id="sf_btn">税费清单</a>
    </div> 
   </div>

  </div>
   <!-- 物业类型select模拟 -->
     <div class="am-modal-actions" id="my-actions-search">
      <div class="am-modal-actions-group">
        <div class="imitate-select-div">  
          <a href="javascript:" class="am-imitate-btn" data-am-modal-close>取消</a>
          <ul id="wy_list" class="ul-imitate-select">

          </ul>
        </div>
      </div>
    </div> 
  <!-- 搜索弹框begin -->
  <div class="am-search-popup"  id="my-popup">
    <div class="am-form-top">
      <form action="" class="am-form">
          <div class="am-form-group">
          <input type="search" id="search_input" name="keywords" oninput="beginsearch()" class="am-search-input" placeholder="搜索小区名">
          <a href="javascript:" class="search-btn"></a>
          </div>
          <span id="am-popup-close" class="am-close">取消</span>
      </form>
    </div>
    <ul class="am-data-result" id="data-list">

    </ul>
</div>
<!-- 搜索弹框end -->
   <p class="am-ftr">中国•昆山 萧林中路2191号昆山楼市•房猫服务中心<br />苏州曼纳吉信息科技有限公司</p>
  <div class="am-menu am-g-fixed am-g-menu">
    <div class="am-u-sm-6"><a href="/wx_index/main" class="am-btn-home"><img src="/assets/i/home.jpg" alt=""></a></div>
    <div class="am-u-sm-6"><a href="/wx_index/person_info" class="am-btn-home"><img src="/assets/i/user.jpg" alt=""></a></div>
  </div>
</div>
<script src="/assets/js/jquery-1.7.1.js"></script>
<script src="/assets/js/amazeui.min.js"></script>
<script src="/assets/js/animateBackground-plugin.js"></script>
<script src="/assets/js/layer/layer.js"></script>
<script type="text/javascript">

//评估价数字滚动效果
  $(function () {
      $('#collapse-nav').on('open.collapse.amui', function() {
          $(".am-show-btn-p").html("暂时不填了").removeClass('am-hidden-btn-p');
          $(".am-show-btn").css({"border-top":"1px solid #e5e5e5"});
      }).on('close.collapse.amui', function() {
          $(".am-show-btn-p").html("继续填写，精准评估").addClass('am-hidden-btn-p');
          $(".am-show-btn").css({"border-top":"none"});
      });
      $("#am-house-input").click(function(event) {
          $("#my-popup").show();$(".am-search-input").focus();
      });$("#am-popup-close").click(function(event) {
          $("#my-popup").hide();$(".am-search-input").blur();
      });
      $("#yy_mianji").keyup(function () {
          $(this).val($(this).val().replace(/[^0-9.]/g, ''));
          if(!/^[0-9]+(.[0-9]{0,2})?$/.test($(this).val())) {$(this).val('');}
      }).blur(function(){
          $(this).val($(this).val().replace(/[^0-9.]/g, ''));
          if(!/^[0-9]+(.[0-9]{0,2})?$/.test($(this).val())) {$(this).val('');}
      }).bind("paste", function () {  //CTR+V事件处理
          $(this).val($(this).val().replace(/[^0-9.]/g, ''));
          if(!/^[0-9]+(.[0-9]{0,2})?$/.test($(this).val())) {$(this).val('');}
      }).css("ime-mode", "disabled"); //CSS设置输入法不可用
      $(".phone4js").keyup(function () {
          $(this).val($(this).val().replace(/[^0-9]/g, ''));
      }).blur(function(){
          $(this).val($(this).val().replace(/[^0-9]/g, ''));
      }).bind("paste", function () {  //CTR+V事件处理
          $(this).val($(this).val().replace(/[^0-9]/g, ''));
      }).css("ime-mode", "disabled"); //CSS设置输入法不可用
      $("#jisuan_btn").click(function () {
          if($("#am-house-input").val() == "请输入" || $("#yy_price_id").val() == ""){
              layer.msg('请先选择小区');
              return false;
          }
          var id_ = $.trim($("#yy_price_id").val());
           if($(".am-show-btn-p").hasClass('am-hidden-btn-p')){
               $.post('/wx_api/api_get_price4jq',{status:1,price_id:id_},function(data){
                   var items = JSON.parse(data);
                   if(items.success){
                       location.href="#my-scrollspy";
                       show_num(items.price,1);

                   }else{
                       layer.msg(items.err_msg);
                       return false;
                   }
               })
           }else{
                var min_c_ = parseInt($("#yy_min_c").val());
                var max_c_ = parseInt($("#yy_max_c").val());
                var flag_ = $("#yy_flag").val();
                var mianji_ = $.trim($("#yy_mianji").val());
                if(mianji_ == ""){
                    layer.msg('请先输入面积');
                    return false;
                }
               var szlc_ = $.trim($("#yy_szlc").val());
                if(flag_ == '1'){
                    if(szlc_ == ""){
                        layer.msg('请先输入所在楼层');
                        return false;
                    }
                    szlc_ = parseInt(szlc_);
                    if(szlc_ > max_c_){
                        layer.msg('所在楼层不规范');
                        return false;
                    }
                }
               var zlc_ = $.trim($("#yy_zlc").val());
               if(zlc_ == ""){
                   layer.msg('请先输入总楼层');
                   return false;
               }
               zlc_ = parseInt(zlc_);
               if(zlc_ > max_c_ || zlc_ < min_c_){
                   layer.msg('总楼层不规范');
                   return false;
               }
               $.post('/wx_api/api_get_price4jq',{status:2,price_id:id_, mianji:mianji_,zlc:zlc_,szlc:szlc_},function(data){
                   var items = JSON.parse(data);
                   if(items.success){
                       show_num(items.price,0);
                       var div_tag3 = $('.am-float-tag3').eq(0);
                       var div_tag2 = $('.am-float-tag2').eq(0);
                       var div_tag1 = $('.am-float-tag1').eq(0);
                       div_tag3.find('em').attr('class','am-em-tag ' + items.hot_class);
                       if(items.flag == 1){
                           //div_tag1.show();
                           div_tag1.find('em').attr('class','am-em-tag ' + items.lc_class);
                           div_tag1.find('em').eq(0).html(items.lc_name);
                       }else{
                           div_tag1.hide();
                       }
                       div_tag2.find('em').attr('class','am-em-tag ' + items.mj_class);
                       div_tag2.find('em').eq(0).html(items.mj_name);
                       location.href="#my-scrollspy";
                   }else{
                       layer.msg(items.err_msg);
                       return false;
                   }
               })
           }
      })
  });

function show_num(n,a) {
    $("#pg_price").val(n);
    $(".am-house-num").html("");
    var it = $(".am-house-num i");
    var len = String(n).length;
    for (var i = 0; i < len; i++) {
        if (it.length <= i) {
            $(".am-house-num").append("<i></i>");
        }
        var num = String(n).charAt(i);
        var y = -parseInt(num) * 30;
        var obj = $(".am-house-num i").eq(i);
        obj.animate({
            backgroundPosition: '(0 ' + String(y) + 'px)'
        }, 'slow', 'swing', function () {
            if($(".am-house-num i").is(":animated")&&a==0){//精准评估
                $(".am-re-price").animate({top:'30%'},'slow','swing',function(){
                    $(".am-float-tag").fadeIn('slow');
                });}
            else if($(".am-house-num i").is(":animated")&&a==1){//快评
                $(".am-re-price").animate({top:'18%'},'slow','swing',function(){
                    $(".am-float-tag").fadeOut();});}
        });
    }
}

function  beginsearch() {

    var search_ = $.trim($("#search_input").val());
    if(search_ == ""){
        $("#data-list").html('');
    }else{
        if(search_.replace(/[\u0391-\uFFE5]/g,"aa").length >= 1){
            $.post('/wx_index/api_get_xiaoqu_list',{search_:search_},function(data){
                var html = '';
                var items = JSON.parse(data);
                for(var i in items) {
                    var item = items[i];
                    html += '<li onclick="choose_xiaoqu(' + item.id + ')"><span class="s-h-name on">' + item.name + '</span><span class="s-h-adress">' + item.other_name + '</span></li>';
                }
                $("#data-list").html(html);
            })

        }else{
            $("#data-list").html('');
        }
    }
}

function choose_xiaoqu(id) {
    $.post('/wx_api/api_get_xiaoqu_info',{xiaoqu_id:id},function(data){
        var html = '';
        var items = JSON.parse(data);
        for(var i in items) {
            var item = items[i];
            if(i == 0){
                $("#yy_address").html(item.address);
                $("#yy_area").html(item.area);
                $("#am-house-input").val(item.name);
                $("#yy_wy").html(item.wy);
                $("#yy_max_c").val(item.max_c);
                $("#yy_min_c").val(item.min_c);
                $("#yy_price_id").val(item.id);
                $("#yy_flag").html(item.flag);
                $("#yy_mianji").val('');
                $("#yy_zlc").val('');
                $("#yy_szlc").val('');
                if(item.flag == 2){
                    $("#yy_szlc_div").hide();
                }else{
                    $("#yy_szlc_div").show();
                }
            }
            html += '<li onclick="choose_wy(\'' + item.flag + '\',\'' + item.min_c + '\',\'' + item.max_c + '\',\'' + item.wy + '\',\'' + item.id + '\')" >' + item.wy +'</li>'
        }
        $("#wy_list").html(html);
        $("#my-popup").hide();$(".am-search-input").blur();
    })
}

function choose_wy(flag,min_c,max_c,wy,id){
    $("#yy_szlc").val('');
      if(flag == '2'){
          $("#yy_szlc_div").hide();
      }else{
          $("#yy_szlc_div").show();
      }
    $("#yy_flag").html(flag);
     $("#yy_wy").html(wy);
      $("#yy_max_c").val(max_c);
    $("#yy_min_c").val(min_c);
    $("#yy_price_id").val(id);
    $("#yy_mianji").val('');
    $("#yy_zlc").val('');
    $("#yy_szlc").val('');
    $("#my-actions-search").modal('close');
}

    $('#sf_btn').click(function(){
        var price_ = $("#pg_price").val();
        window.location.href = '/wx_index/calculator/' + price_;
    })
</script>
</body>
</html>
